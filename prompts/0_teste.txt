PROMPT — STREAMLIT (PÁGINA 0)
0_teste: SELEÇÃO DE ARQUIVOS EM data/excel + “SIMULAR UPLOAD” + INICIALIZAR st.session_state
OBJETIVO: PERMITIR TESTE RÁPIDO COM PLANILHAS LOCAIS E, APÓS SELEÇÃO, O APP SEGUE O FLUXO NORMAL (PÁGINA 1 EM DIANTE)

Você é um desenvolvedor Python especialista em Streamlit e deve implementar uma página chamada `0_teste.py` (ou `pages/0_teste.py`) que serve como “launcher” de testes do sistema.
Essa página lista os arquivos existentes em `data/excel/`, permite escolher um (ou rodar em lote para validação), e ao selecionar um arquivo ela deve carregar os bytes e preencher o `st.session_state` como se fosse um upload real.
Depois disso, o usuário pode ir para a Página 1 (Upload e Conversão) e o fluxo segue normalmente usando os dados já presentes no session_state.

1. OBJETIVO DA PÁGINA 0

1) Mostrar os arquivos existentes em `data/excel/` (ex.: 3 planilhas).
2) Permitir que o usuário:

   1. selecione 1 arquivo e clique “Usar este arquivo” (simular upload)
   2. opcional: rode um “teste em lote” (processar todos e mostrar um painel de status)
3) Ao selecionar 1 arquivo, inicializar o estado do app:

   1. guardar `excel_bytes`, `excel_name`, `excel_source="test_file"`
   2. limpar/zerar states antigos conflitantes (para evitar misturar arquivos)
4) A partir disso, o usuário segue para a Página 1 e o app roda “como sempre”.

2. REGRAS IMPORTANTES

1) A Página 0 NÃO faz conversão Excel→CSV (isso é da Página 1).
2) A Página 0 só prepara o “input” e garante que o session_state esteja pronto.
3) A Página 0 não deve criar lógica duplicada de leitura; se fizer lote, deve chamar as mesmas funções do motor (se existirem), mas o foco é seleção.

3. UI DA PÁGINA 0 (OBRIGATÓRIO)

3.1) Seção “Arquivos disponíveis em data/excel”

1. Listar arquivos com extensões: `.xlsx`, `.xls` (opcional `.xlsm`)
2. Exibir uma tabela simples com colunas:

   1. arquivo
   2. tamanho_kb
   3. modificado_em (data/hora local)
3. Se não existir arquivo, mostrar mensagem objetiva:

   * “Nenhum arquivo encontrado em data/excel/”

3.2) Seção “Selecionar 1 arquivo para simular upload”

1. `selectbox` com os arquivos encontrados
2. Botão “Usar este arquivo”
3. Ao clicar:

   1. ler bytes do arquivo
   2. preencher session_state
   3. mostrar confirmação na tela: “Arquivo carregado no session_state: <nome>”
   4. mostrar também um botão/link de navegação:

      * “Ir para Página 1 (Upload e Conversão)”
      * (Pode ser instrução simples: “Abra a Página 1 no menu lateral”)

3.3) Seção opcional “Teste em lote (sanidade rápida)”

1. Botão “Rodar teste em lote”
2. Ao clicar:

   1. para cada arquivo, tentar apenas abrir/listar abas (sanidade leve)
   2. gerar uma tabela de resultado por arquivo:

      * arquivo | status (ok/error) | abas_detectadas | erro (truncado)
3. Observação: isso é diagnóstico, não persiste df_all/csv.
4. Se o usuário quiser, permitir “Selecionar um arquivo com status ok” e usar como upload simulado.

4) SESSION_STATE (OBRIGATÓRIO)

Ao clicar “Usar este arquivo”, setar:

1. `excel_bytes`: bytes do arquivo
2. `excel_name`: nome do arquivo
3. `excel_source`: string fixa `"test_file"`
4. `excel_sha1`: hash sha1 dos bytes (para auditoria e evitar reprocessamento)

Além disso, limpar estados derivados de arquivo anterior (para não misturar):

5. Remover/chavear para None (se existirem):

   * `sheets_info`
   * `df_resumo_abas`
   * `df_all`
   * `csv_all_bytes`
   * `df_norm`
   * `csv_norm_bytes`
   * `etl_log_norm`

Regra: a limpeza deve ser explícita, lista fixa de chaves, sem apagar o session_state inteiro.

5. CONTRATO ENTRE PÁGINA 0 E PÁGINA 1

A Página 1 deve funcionar assim:

1. Se `excel_bytes` existir no session_state:

   1. exibir: “Arquivo já carregado (modo teste): <excel_name>”
   2. oferecer botão “Processar este arquivo”
   3. permitir “Trocar arquivo” (limpa e volta para Página 0)
2. Se não existir `excel_bytes`, seguir com upload normal.

Ou seja: Página 0 injeta o input e Página 1 faz a conversão Excel → CSV.

6. ORGANIZAÇÃO DO PROJETO (OBRIGATÓRIO)

Estrutura sugerida:

* `app.py` (home ou router)
* `pages/0_teste.py`
* `pages/1_upload_conversao.py`
* `pages/...`

Criar funções utilitárias reutilizáveis (sem UI) em `core/` ou `src/`:

1. `list_test_files(data_dir="data/excel") -> list[Path]`
2. `load_excel_bytes_from_path(path) -> (bytes, name)`
3. `compute_sha1(bytes) -> str`

A Página 0 usa essas funções, sem reinventar.

7. CRITÉRIO DE SUCESSO

1) Página 0 lista os arquivos locais e permite selecionar um.
2) Ao selecionar, session_state fica preenchido como se fosse upload.
3) Página 1 detecta o session_state e processa normalmente (Excel → CSV bruto).
4) Trocar arquivo não mistura dados antigos (limpeza correta).
